{"version":3,"file":"ticket-list.component.js","sourceRoot":"","sources":["file:///C:/Users/funny/Documents/GitHub/dashboard/tmp/broccoli_type_script_compiler-input_base_path-SMUEtNaR.tmp/0/src/app/ticket/ticket-list/ticket-list.component.ts"],"names":[],"mappings":"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","sourcesContent":["import { Component, AfterViewChecked, SimpleChange } from '@angular/core';\r\nimport { Router } from '@angular/router';\r\nimport { GlobalService } from '../../shared/global.service';\r\nimport { AngularFire, FirebaseListObservable, FirebaseObjectObservable } from 'angularfire2';\r\nimport { DateFormatPipe } from '../ticket.pipe';\r\nimport { OrderBy } from '../sort.pipe';\r\nimport { MyFilterPipe } from '../filter.pipe';\r\nimport { Subject } from 'rxjs/Subject';\r\ndeclare var jQuery: any;\r\n\r\n@Component({\r\n  moduleId: module.id,\r\n  selector: 'app-ticket-list',\r\n  templateUrl: 'ticket-list.component.html',\r\n  styleUrls: ['ticket-list.component.css'],\r\n  pipes: [ DateFormatPipe, OrderBy, MyFilterPipe ],\r\n})\r\nexport class TicketListComponent implements AfterViewChecked  {\r\n  datePickerInit = false;\r\n  order = '-start_date';\r\n  ticket_detail;\r\n  filter = 'filter';\r\n  filterText = '';\r\n  ticketsPerPage = 15;\r\n  pageTag = 1;\r\n  currentPage = 1;\r\n  ticket_id = -1;\r\n  ticket_length = 0;\r\n  tickets = [];\r\n  username: FirebaseObjectObservable<any>;\r\n  constructor(private globalService: GlobalService, public af: AngularFire, private router: Router) {\r\n    var url = '/private/'+localStorage.getItem('uid');\r\n    this.username = af.database.object(url);\r\n    af.database.list('/shared/ticket').subscribe(ticket => {\r\n      this.tickets = ticket;\r\n      globalService.ticket_number = ticket.length;\r\n      this.ticket_length = ticket.length;\r\n    });\r\n  }\r\n\r\n  queryBy(order) {\r\n    if (this.order==order) {\r\n      this.order = '-'+this.order;\r\n    }\r\n    else {\r\n      this.order = order;\r\n    }\r\n  }\r\n\r\n  maxPage() {\r\n    return Math.round(this.ticket_length/this.ticketsPerPage);\r\n  }\r\n\r\n  onFilterChange(filter) {\r\n    this.filter = filter;\r\n    jQuery('.input-append.date').attr('id', 'datePicker');\r\n  }\r\n\r\n  filterBy(value: HTMLInputElement, filter) {\r\n    this.filter = filter;\r\n    this.filterText = value.value;\r\n    this.currentPage = 1;\r\n    this.pageTag = 1;\r\n  }\r\n\r\n  onPageNav(value: number) {\r\n    if (this.pageTag+value>0 && this.pageTag+value<=this.ticket_length/this.ticketsPerPage) {\r\n      this.pageTag = this.pageTag + value;\r\n      this.currentPage = this.pageTag;\r\n    }\r\n  }\r\n\r\n  showDatePicker() {\r\n    jQuery('.input-append.date').attr('id', 'datePicker1');\r\n    this.filter = 'date';\r\n  }\r\n\r\n  onPageChange(value: number) {\r\n    this.currentPage = value;\r\n  }\r\n\r\n  viewTicket(value) {\r\n    this.ticket_id = value.id;\r\n    this.ticket_detail = value;\r\n  }\r\n\r\n  comment(name: string, value: HTMLInputElement) {\r\n    var tmp = this.ticket_detail.reply || [];\r\n    tmp.push({\r\n      username: this.globalService.username,\r\n      content: value.value\r\n    });\r\n    value.value = null;\r\n    this.ticket_detail.reply = tmp;\r\n    this.af.database.object('/shared/ticket/'+this.ticket_id).update({ reply: tmp });\r\n  }\r\n\r\n  pageSetup(page: number) {\r\n    this.ticketsPerPage = page;\r\n    this.currentPage = 1;\r\n    this.pageTag = 1;\r\n  }\r\n\r\n  onSolve() {\r\n    var datenow = Math.floor(Date.now()/1000);\r\n    this.ticket_detail.end_date = datenow;\r\n    this.af.database.object('/shared/ticket/'+this.ticket_id).update({ end_date: datenow });\r\n  }\r\n\r\n  ngAfterViewChecked() {\r\n    // console.log('changed');\r\n    if (!this.datePickerInit) {\r\n      jQuery('#datePicker1')\r\n          .datetimepicker({\r\n            language: 'pt-BR',\r\n            maskInput: false,\r\n          });\r\n      this.datePickerInit = true;\r\n      console.log('inited!');\r\n      jQuery('.input-append.date').attr('id', 'datePicker');\r\n    }\r\n    if (this.ticket_length!=Number(localStorage.getItem('tickets_number'))) {\r\n      setTimeout(_ => {\r\n        this.ticket_length = Number(localStorage.getItem('tickets_number'));\r\n      });\r\n    }\r\n  }\r\n\r\n}\r\n"]}